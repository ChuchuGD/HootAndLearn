<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AsignaciÃ³n de Evaluaciones</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
 <link rel="stylesheet" href="./evaluaciones.css">
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <h1 id="app-title">ğŸ“‹ AsignaciÃ³n de Evaluaciones</h1>
    <p id="welcome-message">Asigna evaluaciones a estudiantes y grupos de forma organizada</p>
   </div>
   <div class="actions-bar"><button class="btn btn-primary" id="create-assignment-btn"> â• Nueva AsignaciÃ³n </button> <button class="btn btn-secondary" id="manage-students-btn"> ğŸ‘¥ Gestionar Estudiantes </button> <button class="btn btn-secondary" id="manage-groups-btn"> ğŸ« Gestionar Grupos </button>
   </div>
   <div class="filter-bar">
    <div class="filter-group"><label for="status-filter">Estado:</label> <select id="status-filter"> <option value="all">Todos</option> <option value="active">Activos</option> <option value="pending">Pendientes</option> <option value="overdue">Vencidos</option> </select>
    </div>
    <div class="filter-group"><label for="search-filter">Buscar:</label> <input type="text" id="search-filter" placeholder="TÃ­tulo de evaluaciÃ³n..." style="padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
    </div>
   </div>
   <div id="assignments-container"></div>
  </div><!-- Modal para crear asignaciÃ³n -->
  <div class="modal" id="assignment-modal">
   <div class="modal-content">
    <h2 id="modal-title">ğŸ“ Nueva AsignaciÃ³n de EvaluaciÃ³n</h2>
    <form id="assignment-form">
     <div class="form-group"><label for="eval-title">TÃ­tulo de la EvaluaciÃ³n</label> <input type="text" id="eval-title" required placeholder="Ej: Examen Final de MatemÃ¡ticas">
     </div>
     <div class="form-group"><label for="eval-description">DescripciÃ³n</label> <textarea id="eval-description" required placeholder="Describe los objetivos y contenido de la evaluaciÃ³n"></textarea>
     </div>
     <div class="form-row">
      <div class="form-group"><label for="eval-due-date">Fecha de Entrega</label> <input type="datetime-local" id="eval-due-date" required>
      </div>
      <div class="form-group"><label for="eval-max-score">PuntuaciÃ³n MÃ¡xima</label> <input type="number" id="eval-max-score" required min="1" value="100">
      </div>
     </div>
     <div class="form-group"><label for="eval-instructions">Instrucciones Especiales</label> <textarea id="eval-instructions" placeholder="Instrucciones adicionales para los estudiantes"></textarea>
     </div>
     <div class="student-selector">
      <h4>ğŸ‘¥ Seleccionar Estudiantes</h4>
      <div class="students-grid" id="students-grid"><!-- Estudiantes se cargarÃ¡n aquÃ­ -->
      </div>
     </div>
     <div class="groups-selector">
      <h4>ğŸ« Seleccionar Grupos</h4>
      <div class="groups-grid" id="groups-grid"><!-- Grupos se cargarÃ¡n aquÃ­ -->
      </div>
     </div>
     <div class="modal-actions"><button type="button" class="btn btn-secondary" id="cancel-assignment-btn">Cancelar</button> <button type="submit" class="btn btn-primary" id="submit-assignment-btn">Crear AsignaciÃ³n</button>
     </div>
    </form>
   </div>
  </div><!-- Modal para gestionar estudiantes -->
  <div class="modal" id="students-modal">
   <div class="modal-content">
    <h2>ğŸ‘¥ Gestionar Estudiantes</h2>
    <div class="form-group"><label for="new-student">Agregar Nuevo Estudiante</label>
     <div style="display: flex; gap: 12px;"><input type="text" id="new-student" placeholder="Nombre del estudiante" style="flex: 1;"> <button type="button" class="btn btn-success" id="add-student-btn">Agregar</button>
     </div>
    </div>
    <div id="students-list"></div>
    <div class="modal-actions"><button type="button" class="btn btn-secondary" id="close-students-btn">Cerrar</button>
    </div>
   </div>
  </div><!-- Modal para gestionar grupos -->
  <div class="modal" id="groups-modal">
   <div class="modal-content">
    <h2>ğŸ« Gestionar Grupos</h2>
    <div class="form-group"><label for="new-group">Agregar Nuevo Grupo</label>
     <div style="display: flex; gap: 12px;"><input type="text" id="new-group" placeholder="Nombre del grupo" style="flex: 1;"> <button type="button" class="btn btn-success" id="add-group-btn">Agregar</button>
     </div>
    </div>
    <div id="groups-list"></div>
    <div class="modal-actions"><button type="button" class="btn btn-secondary" id="close-groups-btn">Cerrar</button>
    </div>
   </div>
  </div><!-- Toast para notificaciones -->
  <div class="toast" id="toast"></div>
  <script>
    const defaultConfig = {
      app_title: "ğŸ“‹ AsignaciÃ³n de Evaluaciones",
      welcome_message: "Asigna evaluaciones a estudiantes y grupos de forma organizada",
      primary_color: "#4f46e5",
      secondary_color: "#ffffff",
      text_color: "#1e293b",
      success_color: "#10b981",
      danger_color: "#ef4444"
    };
    
    let assignments = [];
    let students = ['Ana GarcÃ­a', 'Carlos LÃ³pez', 'MarÃ­a RodrÃ­guez', 'Juan PÃ©rez', 'Laura MartÃ­n', 'Diego Silva', 'Carmen Ruiz', 'Pablo Torres'];
    let groups = ['Grupo A', 'Grupo B', 'Grupo C', 'MatemÃ¡ticas Avanzadas', 'Ciencias Naturales'];
    
    const dataHandler = {
      onDataChanged(data) {
        assignments = data;
        renderAssignments();
      }
    };
    
    async function initializeApp() {
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        showToast('Error al inicializar el sistema', 'error');
        console.error('Failed to initialize data SDK');
      }
      
      loadStudentsAndGroups();
    }
    
    function loadStudentsAndGroups() {
      renderStudentsGrid();
      renderGroupsGrid();
      renderStudentsList();
      renderGroupsList();
    }
    
    function renderStudentsGrid() {
      const grid = document.getElementById('students-grid');
      grid.innerHTML = students.map((student, index) => `
        <div class="student-item" data-student="${student}">
          <input type="checkbox" id="student-${index}" value="${student}">
          <label for="student-${index}">${student}</label>
        </div>
      `).join('');
      
      grid.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', (e) => {
          const item = e.target.closest('.student-item');
          item.classList.toggle('selected', e.target.checked);
        });
      });
    }
    
    function renderGroupsGrid() {
      const grid = document.getElementById('groups-grid');
      grid.innerHTML = groups.map((group, index) => `
        <div class="group-item" data-group="${group}">
          <input type="checkbox" id="group-${index}" value="${group}">
          <label for="group-${index}">${group}</label>
        </div>
      `).join('');
      
      grid.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', (e) => {
          const item = e.target.closest('.group-item');
          item.classList.toggle('selected', e.target.checked);
        });
      });
    }
    
    function renderStudentsList() {
      const list = document.getElementById('students-list');
      list.innerHTML = `
        <h4 style="margin: 20px 0 12px 0; color: #374151;">Estudiantes Registrados (${students.length})</h4>
        <div style="max-height: 300px; overflow-y: auto;">
          ${students.map(student => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px; margin-bottom: 8px;">
              <span style="font-weight: 500;">${student}</span>
              <button class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;" onclick="removeStudent('${student}')">Eliminar</button>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    function renderGroupsList() {
      const list = document.getElementById('groups-list');
      list.innerHTML = `
        <h4 style="margin: 20px 0 12px 0; color: #374151;">Grupos Registrados (${groups.length})</h4>
        <div style="max-height: 300px; overflow-y: auto;">
          ${groups.map(group => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f0fdf4; border-radius: 8px; margin-bottom: 8px;">
              <span style="font-weight: 500;">${group}</span>
              <button class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;" onclick="removeGroup('${group}')">Eliminar</button>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    function addStudent() {
      const input = document.getElementById('new-student');
      const name = input.value.trim();
      
      if (!name) {
        showToast('Por favor ingresa un nombre', 'error');
        return;
      }
      
      if (students.includes(name)) {
        showToast('Este estudiante ya existe', 'error');
        return;
      }
      
      students.push(name);
      input.value = '';
      loadStudentsAndGroups();
      showToast('Estudiante agregado exitosamente', 'success');
    }
    
    function addGroup() {
      const input = document.getElementById('new-group');
      const name = input.value.trim();
      
      if (!name) {
        showToast('Por favor ingresa un nombre', 'error');
        return;
      }
      
      if (groups.includes(name)) {
        showToast('Este grupo ya existe', 'error');
        return;
      }
      
      groups.push(name);
      input.value = '';
      loadStudentsAndGroups();
      showToast('Grupo agregado exitosamente', 'success');
    }
    
    function removeStudent(name) {
      students = students.filter(s => s !== name);
      loadStudentsAndGroups();
      showToast('Estudiante eliminado', 'success');
    }
    
    function removeGroup(name) {
      groups = groups.filter(g => g !== name);
      loadStudentsAndGroups();
      showToast('Grupo eliminado', 'success');
    }
    
    function getAssignmentStatus(assignment) {
      const dueDate = new Date(assignment.dueDate);
      const now = new Date();
      
      if (dueDate < now) {
        return 'overdue';
      } else if (dueDate - now < 24 * 60 * 60 * 1000) {
        return 'pending';
      } else {
        return 'active';
      }
    }
    
    function getStatusText(status) {
      switch (status) {
        case 'active': return 'Activo';
        case 'pending': return 'PrÃ³ximo';
        case 'overdue': return 'Vencido';
        default: return 'Activo';
      }
    }
    
    function filterAssignments() {
      const statusFilter = document.getElementById('status-filter').value;
      const searchFilter = document.getElementById('search-filter').value.toLowerCase();
      
      return assignments.filter(assignment => {
        const matchesStatus = statusFilter === 'all' || getAssignmentStatus(assignment) === statusFilter;
        const matchesSearch = assignment.evaluationTitle.toLowerCase().includes(searchFilter) ||
                             assignment.description.toLowerCase().includes(searchFilter);
        
        return matchesStatus && matchesSearch;
      });
    }
    
    function renderAssignments() {
      const container = document.getElementById('assignments-container');
      const filteredAssignments = filterAssignments();
      
      if (filteredAssignments.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“‹</div>
            <h3>No hay asignaciones</h3>
            <p>Comienza creando tu primera asignaciÃ³n de evaluaciÃ³n para organizar el trabajo de tus estudiantes</p>
            <button class="btn btn-primary" onclick="openAssignmentModal()">Crear Primera AsignaciÃ³n</button>
          </div>
        `;
        return;
      }
      
      container.innerHTML = `<div class="assignments-grid">${filteredAssignments.map(assignment => {
        const status = getAssignmentStatus(assignment);
        const dueDate = new Date(assignment.dueDate);
        const assignedStudents = assignment.assignedStudents ? JSON.parse(assignment.assignedStudents) : [];
        const assignedGroups = assignment.assignedGroups ? JSON.parse(assignment.assignedGroups) : [];
        
        return `
          <div class="assignment-card ${status}" data-id="${assignment.id}">
            <div class="assignment-header">
              <h3 class="assignment-title">${assignment.evaluationTitle}</h3>
              <span class="status-badge ${status}">${getStatusText(status)}</span>
            </div>
            
            <p class="assignment-description">${assignment.description}</p>
            
            <div class="assignment-meta">
              <div class="meta-item">
                <span class="meta-label">Fecha de Entrega</span>
                <span class="meta-value">${dueDate.toLocaleDateString('es-ES')} ${dueDate.toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'})}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">PuntuaciÃ³n MÃ¡xima</span>
                <span class="meta-value">${assignment.maxScore} puntos</span>
              </div>
            </div>
            
            <div class="assigned-to">
              <h4>ğŸ‘¥ Estudiantes Asignados (${assignedStudents.length})</h4>
              <div class="assigned-students">
                ${assignedStudents.slice(0, 5).map(student => `<span class="student-tag">${student}</span>`).join('')}
                ${assignedStudents.length > 5 ? `<span class="student-tag">+${assignedStudents.length - 5} mÃ¡s</span>` : ''}
              </div>
              
              <h4 style="margin-top: 12px;">ğŸ« Grupos Asignados (${assignedGroups.length})</h4>
              <div class="assigned-groups">
                ${assignedGroups.map(group => `<span class="group-tag">${group}</span>`).join('')}
              </div>
            </div>
            
            <div class="card-actions">
              <button class="btn btn-primary view-btn" data-id="${assignment.id}">Ver Detalles</button>
              <button class="btn btn-warning edit-btn" data-id="${assignment.id}">Editar</button>
              <button class="btn btn-danger delete-btn" data-id="${assignment.id}">Eliminar</button>
            </div>
          </div>
        `;
      }).join('')}</div>`;
      
      // Agregar event listeners
      document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = e.target.dataset.id;
          viewAssignmentDetails(id);
        });
      });
      
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = e.target.dataset.id;
          editAssignment(id);
        });
      });
      
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = e.target.dataset.id;
          deleteAssignment(id);
        });
      });
    }
    
    function viewAssignmentDetails(id) {
      const assignment = assignments.find(a => a.id === id);
      if (!assignment) return;
      
      const assignedStudents = assignment.assignedStudents ? JSON.parse(assignment.assignedStudents) : [];
      const assignedGroups = assignment.assignedGroups ? JSON.parse(assignment.assignedGroups) : [];
      const dueDate = new Date(assignment.dueDate);
      
      showToast(`
        ğŸ“‹ ${assignment.evaluationTitle}
        
        ğŸ“… Entrega: ${dueDate.toLocaleDateString('es-ES')} ${dueDate.toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'})}
        
        ğŸ‘¥ Estudiantes: ${assignedStudents.join(', ')}
        ğŸ« Grupos: ${assignedGroups.join(', ')}
        
        ğŸ“ Instrucciones: ${assignment.instructions || 'Sin instrucciones especiales'}
      `, 'success');
    }
    
    function editAssignment(id) {
      const assignment = assignments.find(a => a.id === id);
      if (!assignment) return;
      
      // Llenar el formulario con los datos existentes
      document.getElementById('eval-title').value = assignment.evaluationTitle;
      document.getElementById('eval-description').value = assignment.description;
      document.getElementById('eval-due-date').value = new Date(assignment.dueDate).toISOString().slice(0, 16);
      document.getElementById('eval-max-score').value = assignment.maxScore;
      document.getElementById('eval-instructions').value = assignment.instructions || '';
      
      // Marcar estudiantes y grupos asignados
      const assignedStudents = assignment.assignedStudents ? JSON.parse(assignment.assignedStudents) : [];
      const assignedGroups = assignment.assignedGroups ? JSON.parse(assignment.assignedGroups) : [];
      
      document.querySelectorAll('#students-grid input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = assignedStudents.includes(checkbox.value);
        checkbox.closest('.student-item').classList.toggle('selected', checkbox.checked);
      });
      
      document.querySelectorAll('#groups-grid input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = assignedGroups.includes(checkbox.value);
        checkbox.closest('.group-item').classList.toggle('selected', checkbox.checked);
      });
      
      // Cambiar el tÃ­tulo del modal y guardar el ID para ediciÃ³n
      document.getElementById('modal-title').textContent = 'âœï¸ Editar AsignaciÃ³n';
      document.getElementById('submit-assignment-btn').textContent = 'Actualizar AsignaciÃ³n';
      document.getElementById('assignment-form').dataset.editId = id;
      
      document.getElementById('assignment-modal').classList.add('active');
    }
    
    async function deleteAssignment(id) {
      const assignment = assignments.find(a => a.id === id);
      if (!assignment) return;
      
      const card = document.querySelector(`[data-id="${id}"]`);
      const deleteBtn = card.querySelector('.delete-btn');
      
      if (deleteBtn.textContent === 'Eliminar') {
        deleteBtn.textContent = 'Â¿Confirmar?';
        deleteBtn.classList.remove('btn-danger');
        deleteBtn.classList.add('btn-secondary');
        
        setTimeout(() => {
          if (deleteBtn.textContent === 'Â¿Confirmar?') {
            deleteBtn.textContent = 'Eliminar';
            deleteBtn.classList.remove('btn-secondary');
            deleteBtn.classList.add('btn-danger');
          }
        }, 3000);
        return;
      }
      
      deleteBtn.disabled = true;
      deleteBtn.innerHTML = '<span class="spinner"></span>Eliminando...';
      
      const result = await window.dataSdk.delete(assignment);
      
      if (result.isOk) {
        showToast('AsignaciÃ³n eliminada exitosamente', 'success');
      } else {
        showToast('Error al eliminar la asignaciÃ³n', 'error');
        deleteBtn.disabled = false;
        deleteBtn.textContent = 'Eliminar';
      }
    }
    
    function openAssignmentModal() {
      document.getElementById('assignment-form').reset();
      document.getElementById('modal-title').textContent = 'ğŸ“ Nueva AsignaciÃ³n de EvaluaciÃ³n';
      document.getElementById('submit-assignment-btn').textContent = 'Crear AsignaciÃ³n';
      delete document.getElementById('assignment-form').dataset.editId;
      
      // Limpiar selecciones
      document.querySelectorAll('.student-item, .group-item').forEach(item => {
        item.classList.remove('selected');
        item.querySelector('input[type="checkbox"]').checked = false;
      });
      
      // Establecer fecha por defecto (una semana desde hoy)
      const nextWeek = new Date();
      nextWeek.setDate(nextWeek.getDate() + 7);
      document.getElementById('eval-due-date').value = nextWeek.toISOString().slice(0, 16);
      
      document.getElementById('assignment-modal').classList.add('active');
    }
    
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type} show`;
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 4000);
    }
    
    // Event Listeners
    document.getElementById('create-assignment-btn').addEventListener('click', openAssignmentModal);
    
    document.getElementById('manage-students-btn').addEventListener('click', () => {
      document.getElementById('students-modal').classList.add('active');
    });
    
    document.getElementById('manage-groups-btn').addEventListener('click', () => {
      document.getElementById('groups-modal').classList.add('active');
    });
    
    document.getElementById('cancel-assignment-btn').addEventListener('click', () => {
      document.getElementById('assignment-modal').classList.remove('active');
    });
    
    document.getElementById('close-students-btn').addEventListener('click', () => {
      document.getElementById('students-modal').classList.remove('active');
    });
    
    document.getElementById('close-groups-btn').addEventListener('click', () => {
      document.getElementById('groups-modal').classList.remove('active');
    });
    
    document.getElementById('add-student-btn').addEventListener('click', addStudent);
    document.getElementById('add-group-btn').addEventListener('click', addGroup);
    
    document.getElementById('new-student').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') addStudent();
    });
    
    document.getElementById('new-group').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') addGroup();
    });
    
    document.getElementById('status-filter').addEventListener('change', renderAssignments);
    document.getElementById('search-filter').addEventListener('input', renderAssignments);
    
    document.getElementById('assignment-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (assignments.length >= 999 && !e.target.dataset.editId) {
        showToast('LÃ­mite mÃ¡ximo de 999 asignaciones alcanzado', 'error');
        return;
      }
      
      const title = document.getElementById('eval-title').value.trim();
      const description = document.getElementById('eval-description').value.trim();
      const dueDate = document.getElementById('eval-due-date').value;
      const maxScore = parseInt(document.getElementById('eval-max-score').value);
      const instructions = document.getElementById('eval-instructions').value.trim();
      
      const selectedStudents = Array.from(document.querySelectorAll('#students-grid input[type="checkbox"]:checked')).map(cb => cb.value);
      const selectedGroups = Array.from(document.querySelectorAll('#groups-grid input[type="checkbox"]:checked')).map(cb => cb.value);
      
      if (selectedStudents.length === 0 && selectedGroups.length === 0) {
        showToast('Debes seleccionar al menos un estudiante o grupo', 'error');
        return;
      }
      
      const submitBtn = document.getElementById('submit-assignment-btn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="spinner"></span>Guardando...';
      
      const assignmentData = {
        evaluationTitle: title,
        description,
        dueDate: new Date(dueDate).toISOString(),
        maxScore,
        instructions,
        assignedStudents: JSON.stringify(selectedStudents),
        assignedGroups: JSON.stringify(selectedGroups),
        status: 'active'
      };
      
      let result;
      if (e.target.dataset.editId) {
        // Editar asignaciÃ³n existente
        const existingAssignment = assignments.find(a => a.id === e.target.dataset.editId);
        result = await window.dataSdk.update({
          ...existingAssignment,
          ...assignmentData
        });
      } else {
        // Crear nueva asignaciÃ³n
        result = await window.dataSdk.create({
          id: Date.now().toString(),
          ...assignmentData,
          createdAt: new Date().toISOString()
        });
      }
      
      submitBtn.disabled = false;
      submitBtn.innerHTML = e.target.dataset.editId ? 'Actualizar AsignaciÃ³n' : 'Crear AsignaciÃ³n';
      
      if (result.isOk) {
        showToast(e.target.dataset.editId ? 'AsignaciÃ³n actualizada exitosamente' : 'AsignaciÃ³n creada exitosamente', 'success');
        document.getElementById('assignment-modal').classList.remove('active');
      } else {
        showToast('Error al guardar la asignaciÃ³n', 'error');
      }
    });
    
    async function onConfigChange(config) {
      document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
      document.getElementById('welcome-message').textContent = config.welcome_message || defaultConfig.welcome_message;
      
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const successColor = config.success_color || defaultConfig.success_color;
      const dangerColor = config.danger_color || defaultConfig.danger_color;
      
      document.body.style.background = `linear-gradient(135deg, ${primaryColor} 0%, #7c3aed 100%)`;
      
      document.querySelectorAll('.btn-primary').forEach(btn => {
        btn.style.background = primaryColor;
      });
      
      document.querySelectorAll('.btn-success').forEach(btn => {
        btn.style.background = successColor;
      });
      
      document.querySelectorAll('.btn-danger').forEach(btn => {
        btn.style.background = dangerColor;
      });
      
      document.querySelectorAll('.header, .actions-bar, .assignment-card, .modal-content, .empty-state, .filter-bar').forEach(el => {
        el.style.background = secondaryColor;
      });
      
      document.querySelectorAll('h1, h2, h3, .assignment-title').forEach(el => {
        el.style.color = textColor;
      });
    }
    
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => config.secondary_color || defaultConfig.secondary_color,
              set: (value) => {
                config.secondary_color = value;
                window.elementSdk.setConfig({ secondary_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.success_color || defaultConfig.success_color,
              set: (value) => {
                config.success_color = value;
                window.elementSdk.setConfig({ success_color: value });
              }
            },
            {
              get: () => config.danger_color || defaultConfig.danger_color,
              set: (value) => {
                config.danger_color = value;
                window.elementSdk.setConfig({ danger_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["app_title", config.app_title || defaultConfig.app_title],
          ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
        ])
      });
    }
    
    initializeApp();
  </script>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("form-evaluacion");
  if (!form) return;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const datos = new FormData(form);
    const respuesta = await fetch("guardar_evaluacion.php", {
      method: "POST",
      body: datos
    });

    const resultado = await respuesta.json();
    alert(resultado.message);

    if (resultado.status === "success") {
      form.reset();
    }
  });
});
</script>
</body>
</html>